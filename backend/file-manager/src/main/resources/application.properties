# application.properties — file-manager

# Porta interna do app (no container fica 8080; no host mapeamos 8082:8080)
server.port=${SERVER_PORT:8082}

# Datasource (prioriza SPRING_DATASOURCE_URL; fallback para DB_URL; default aponta para o serviço 'db')
spring.datasource.url=${SPRING_DATASOURCE_URL:${DB_URL:jdbc:mysql://db:3306/english?createDatabaseIfNotExist=true&useSSL=false&allowPublicKeyRetrieval=true&serverTimezone=UTC}}
spring.datasource.username=${SPRING_DATASOURCE_USERNAME:app}
spring.datasource.password=${SPRING_DATASOURCE_PASSWORD:app}

spring.jpa.hibernate.ddl-auto=validate
spring.jpa.properties.hibernate.jdbc.time_zone=UTC

spring.flyway.enabled=true
spring.flyway.locations=classpath:db/migration

management.endpoints.web.exposure.include=health,info,metrics,prometheus

# MinIO (alinha com docker-compose: admin/admin123)
minio.endpoint=${MINIO_ENDPOINT:http://minio:9000}
minio.access-key=${MINIO_ACCESS_KEY:admin}
minio.secret-key=${MINIO_SECRET_KEY:admin123}
minio.bucket=${MINIO_BUCKET:countword}

# Publicador: rest (MVP) ou kafka
publisher.mode=${PUBLISH_MODE:rest}

# Domínio (serviço word-manager no compose)
domain.base-url=${DOMAIN_BASE_URL:http://word-manager:8080}
domain.header-user-id=${DOMAIN_USER_HEADER:X-User-Id}

# Webhook (deixe vazio para desabilitar verificação)
webhook.hmac-secret=${WEBHOOK_HMAC_SECRET:}

# Kafka (se/quando habilitar)
spring.kafka.bootstrap-servers=${KAFKA_BOOTSTRAP:kafka:9092}

# Arquivos TXT
file.allowed-content-types=${FILE_ALLOWED_CONTENT_TYPES:text/plain}
file.max-size-bytes=${FILE_MAX_SIZE_BYTES:2097152}
spring.security.oauth2.resourceserver.jwt.jwk-set-uri=${SPRING_SECURITY_OAUTH2_RESOURCESERVER_JWT_JWK_SET_URI:http://keycloak:8080/realms/english-realm/protocol/openid-connect/certs}


spring.application.name=file-manager

spring.kafka.consumer.group-id=${KAFKA_GROUP_ID:file-manager}
spring.kafka.consumer.auto-offset-reset=earliest
spring.kafka.properties.spring.json.trusted.packages=*

minio.accessKey=${MINIO_ACCESS_KEY:admin}
minio.secretKey=${MINIO_SECRET_KEY:admin}
minio.region=${MINIO_REGION:us-east-1}

topics.fileStored=cw.file.stored
topics.wordDetected=cw.word.detected
